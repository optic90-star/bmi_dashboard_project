<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ìˆ˜ì•„ë™í˜ê°€ì¡± Ultimate BMI Dashboard 2.0</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    .animated-bg {
      background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c);
      background-size: 400% 400%;
      animation: gradientMove 15s ease infinite;
    }

    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .glassmorphism {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
    }

    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-hover:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 25px 50px rgba(0,0,0,0.2);
    }

    .neon-glow {
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.6),
                  0 0 40px rgba(102, 126, 234, 0.4),
                  0 0 60px rgba(102, 126, 234, 0.2);
    }

    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .float { animation: float 6s ease-in-out infinite; }
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }

    .sparkle {
      position: relative;
      overflow: hidden;
    }
    
    .sparkle::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: sparkle 3s infinite;
    }

    @keyframes sparkle {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .gradient-text {
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #feca57);
      background-size: 300% 300%;
      animation: gradientText 3s ease-in-out infinite;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    @keyframes gradientText {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .bmi-excellent { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .bmi-good { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    .bmi-warning { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
    .bmi-danger { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }

    .progress-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(#4facfe 0deg, #4facfe var(--progress), rgba(255,255,255,0.2) var(--progress));
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .progress-circle::before {
      content: '';
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(255,255,255,0.9);
      position: absolute;
    }

    .progress-value {
      position: relative;
      z-index: 1;
      font-weight: bold;
      color: #333;
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-up {
      animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 768px) {
      .glassmorphism {
        backdrop-filter: blur(10px);
      }
      .card-hover:hover {
        transform: translateY(-5px) scale(1.01);
      }
    }
  </style>
</head>

<body class="animated-bg">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    const FAMILY_PASSWORD = "1115";

    const initialFamilyData = {
      dad: { 
        id: 'dad', name: 'ë¯¼ì² ', emoji: 'ğŸ‘¨â€ğŸ¦³', dob: '1971-05-05', height: 178, weight: 95, age: 54, 
        desc: 'ë°±ë°œ, í˜„ì¬ ì§‘ì—ë§Œ ê³„ì‹¬', recommendedWeight: 79.2, recommendedBMI: 25,
        profession: 'íœ´ì‹ì¤‘', healthGoal: 'ì²´ì¤‘ê°ëŸ‰', activityLevel: 'low'
      },
      mom: { 
        id: 'mom', name: 'ì„ ì˜', emoji: 'ğŸ‘©â€ğŸ’¼', dob: '1970-11-15', height: 177, weight: 75, age: 54, 
        desc: 'êµ­ë¯¼ì€í–‰ ë¶€ì§€ì ì¥, í†µë¼ˆ', recommendedWeight: 72.1, recommendedBMI: 23,
        profession: 'ì€í–‰ì›', healthGoal: 'ê±´ê°•ìœ ì§€', activityLevel: 'medium'
      },
      daughter: { 
        id: 'daughter', name: 'ìˆ˜ì•„', emoji: 'ğŸ€', dob: '2005-01-09', height: 171, weight: 71, age: 20, 
        desc: 'í•œêµ­ì²´ëŒ€ 3í•™ë…„, ë†êµ¬ ì£¼ì „ ì„¼í„°', recommendedWeight: 70.2, recommendedBMI: 24,
        profession: 'í•™ìƒ-ì²´ìœ¡', healthGoal: 'ê·¼ë ¥ì¦ê°€', activityLevel: 'high'
      },
      son: { 
        id: 'son', name: 'ë™í˜', emoji: 'âœˆï¸', dob: '2007-02-19', height: 187, weight: 71, age: 18, 
        desc: 'ê³ 3 ìˆ˜í—˜ìƒ, ìŠ¤íŠœì–´ë“œ í¬ë§', recommendedWeight: 76.9, recommendedBMI: 22,
        profession: 'í•™ìƒ-ê³ 3', healthGoal: 'ì²´ì¤‘ì¦ê°€', activityLevel: 'low'
      }
    };

    // íŒ¨ìŠ¤ì›Œë“œ ê²Œì´íŠ¸ ì»´í¬ë„ŒíŠ¸
    const PasswordGate = ({ onAccess }) => {
      const [input, setInput] = useState("");
      const [error, setError] = useState("");
      const [isLoading, setIsLoading] = useState(false);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setIsLoading(true);
        await new Promise(resolve => setTimeout(resolve, 800));
        
        if (input === FAMILY_PASSWORD) {
          onAccess(true);
        } else {
          setError("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤ âŒ");
          setIsLoading(false);
        }
      };

      return (
        <div className="min-h-screen flex items-center justify-center p-4">
          <div className="glassmorphism rounded-3xl p-8 w-full max-w-md float">
            <div className="text-center mb-8">
              <div className="text-7xl mb-6 pulse">ğŸ </div>
              <h1 className="text-4xl font-bold text-white mb-3 gradient-text">ê°€ì¡± ì „ìš©</h1>
              <h2 className="text-xl text-white/80 font-medium">Ultimate Health Dashboard</h2>
              <p className="text-white/60 text-sm mt-2">ìš°ë¦¬ ê°€ì¡±ë§Œì˜ íŠ¹ë³„í•œ ê±´ê°• ê´€ë¦¬ ê³µê°„</p>
            </div>
            
            <form onSubmit={handleSubmit} className="space-y-6">
              <div className="relative group">
                <i className="fas fa-lock absolute left-4 top-1/2 transform -translate-y-1/2 text-white/60 group-focus-within:text-white/80 transition-colors"></i>
                <input 
                  type="password" 
                  placeholder="ê°€ì¡± ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                  value={input} 
                  onChange={e => setInput(e.target.value)}
                  className="w-full pl-12 pr-4 py-4 bg-white/10 border border-white/20 rounded-2xl text-white placeholder-white/50 backdrop-blur-sm focus:outline-none focus:border-white/50 focus:bg-white/15 transition-all"
                  disabled={isLoading}
                />
              </div>
              
              {error && (
                <div className="text-red-300 text-center bg-red-500/20 py-3 px-4 rounded-xl border border-red-400/30 fade-in">
                  <i className="fas fa-exclamation-triangle mr-2"></i>
                  {error}
                </div>
              )}
              
              <button 
                type="submit" 
                disabled={isLoading}
                className="w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-2xl sparkle hover:from-purple-600 hover:to-pink-600 disabled:opacity-50 transition-all transform hover:scale-105 neon-glow"
              >
                {isLoading ? (
                  <div className="flex items-center justify-center space-x-2">
                    <div className="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div>
                    <span>ì¸ì¦ ì¤‘...</span>
                  </div>
                ) : (
                  <span><i className="fas fa-door-open mr-2"></i>ì…ì¥í•˜ê¸°</span>
                )}
              </button>
            </form>
            
            <div className="text-center mt-6 text-white/50 text-sm">
              <i className="fas fa-shield-alt mr-1"></i>
              ë³´ì•ˆ ì—°ê²°ë¡œ ë³´í˜¸ë¨
            </div>
          </div>
        </div>
      );
    };

    // BMI ì§„í–‰ë¥  ì›í˜• ì°¨íŠ¸
    const CircularProgress = ({ value, maxValue, size = 120, color = "#4facfe" }) => {
      const percentage = Math.min((value / maxValue) * 100, 100);
      const degrees = (percentage / 100) * 360;
      
      return (
        <div 
          className="progress-circle" 
          style={{ '--progress': `${degrees}deg` }}
        >
          <div className="progress-value text-xl font-bold">
            {value.toFixed(1)}
          </div>
        </div>
      );
    };

    // AI ê±´ê°• ì¸ì‚¬ì´íŠ¸ ì»´í¬ë„ŒíŠ¸
    const HealthInsights = ({ memberData, baseData }) => {
      const insights = useMemo(() => {
        const heightM = baseData.height / 100;
        const currentBmi = memberData.weight ? (memberData.weight / (heightM * heightM)) : 0;
        const targetBmi = memberData.targetWeight ? (memberData.targetWeight / (heightM * heightM)) : 0;
        const weightDiff = memberData.targetWeight ? (memberData.targetWeight - memberData.weight) : 0;
        
        const recommendations = [];
        const tips = [];
        
        if (currentBmi < 18.5) {
          recommendations.push("ğŸ’ª ì²´ì¤‘ ì¦ê°€ë¥¼ ìœ„í•œ ê·¼ë ¥ ìš´ë™ê³¼ ë‹¨ë°±ì§ˆ ì„­ì·¨ë¥¼ ëŠ˜ë ¤ë³´ì„¸ìš”");
          tips.push("ğŸ¥› ë‹¨ë°±ì§ˆ ì‰ì´í¬, ê²¬ê³¼ë¥˜, ì•„ë³´ì¹´ë„ ë“± ê³ ì¹¼ë¡œë¦¬ ê±´ê°•ì‹í’ˆ ì¶”ì²œ");
        } else if (currentBmi > 25) {
          recommendations.push("ğŸƒâ€â™€ï¸ ìœ ì‚°ì†Œ ìš´ë™ê³¼ ì‹ë‹¨ ì¡°ì ˆë¡œ ê±´ê°•í•œ ì²´ì¤‘ ê°ëŸ‰ì„ í•´ë³´ì„¸ìš”");
          tips.push("ğŸ¥— ì£¼ 3íšŒ ì´ìƒ ìš´ë™, ì €ì—¼ì‹, ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨ê°€ ë„ì›€ì´ ë©ë‹ˆë‹¤");
        } else {
          recommendations.push("âœ¨ í˜„ì¬ ê±´ê°•í•œ ì²´ì¤‘ì„ ì˜ ìœ ì§€í•˜ê³  ìˆì–´ìš”!");
          tips.push("ğŸŒŸ ê¾¸ì¤€í•œ ìš´ë™ê³¼ ê· í˜•ì¡íŒ ì‹ë‹¨ìœ¼ë¡œ í˜„ì¬ ìƒíƒœë¥¼ ìœ ì§€í•˜ì„¸ìš”");
        }
        
        if (Math.abs(weightDiff) > 5) {
          recommendations.push(`ğŸ¯ ëª©í‘œê¹Œì§€ ${Math.abs(weightDiff).toFixed(1)}kg, ì›” 1-2kgì”© ${weightDiff > 0 ? 'ì¦ê°€' : 'ê°ì†Œ'}ê°€ ê±´ê°•í•´ìš”`);
        }

        // í™œë™ëŸ‰ì— ë”°ë¥¸ ì¶”ì²œ
        if (baseData.activityLevel === 'high') {
          tips.push("âš¡ ìš´ë™ëŸ‰ì´ ë§ìœ¼ë‹ˆ ì¶©ë¶„í•œ íœ´ì‹ê³¼ ì˜ì–‘ ë³´ì¶©ì´ ì¤‘ìš”í•´ìš”");
        } else if (baseData.activityLevel === 'low') {
          tips.push("ğŸš¶â€â™€ï¸ ì¼ì¼ ë§Œë³´ ê±·ê¸°ë¶€í„° ì‹œì‘í•´ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?");
        }

        return { currentBmi, targetBmi, weightDiff, recommendations, tips };
      }, [memberData, baseData]);

      return (
        <div className="glassmorphism rounded-2xl p-4 mt-4 slide-up">
          <h4 className="text-white font-semibold mb-3 flex items-center">
            <i className="fas fa-brain mr-2 text-purple-300"></i>
            AI ê±´ê°• ì¸ì‚¬ì´íŠ¸
          </h4>
          <div className="space-y-3">
            {insights.recommendations.map((rec, idx) => (
              <div key={idx} className="text-white/90 text-sm bg-white/10 rounded-lg p-3 border-l-4 border-blue-400">
                {rec}
              </div>
            ))}
            {insights.tips.map((tip, idx) => (
              <div key={idx} className="text-white/80 text-xs bg-white/5 rounded-lg p-2 border border-white/10">
                {tip}
              </div>
            ))}
          </div>
        </div>
      );
    };

    // ê°€ì¡± êµ¬ì„±ì› ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
    const FamilyMember = ({ memberData, onUpdate, baseData }) => {
      const [localData, setLocalData] = useState(memberData);
      const [isSaving, setIsSaving] = useState(false);
      const [saveStatus, setSaveStatus] = useState('');
      const [showDetails, setShowDetails] = useState(false);

      useEffect(() => setLocalData(memberData), [memberData]);

      const handleChange = (field, value) => setLocalData(prev => ({ ...prev, [field]: value }));

      const handleSave = async () => {
        setIsSaving(true);
        setSaveStatus('ì €ì¥ ì¤‘...');
        try {
          const dataToSave = { 
            ...localData, 
            weight: Number(localData.weight), 
            targetWeight: Number(localData.targetWeight) 
          };
          await onUpdate(dataToSave);
          setSaveStatus('ì €ì¥ ì™„ë£Œ! âœ…');
        } catch (e) {
          console.error('ì €ì¥ ì‹¤íŒ¨:', e);
          setSaveStatus('ì €ì¥ ì‹¤íŒ¨! âŒ');
        } finally {
          setTimeout(() => setSaveStatus(''), 3000);
          setIsSaving(false);
        }
      };

      const heightM = baseData.height / 100;
      const currentBmi = localData.weight && localData.weight > 0 ? (localData.weight / (heightM * heightM)) : 0;
      const targetBmi = localData.targetWeight ? (localData.targetWeight / (heightM * heightM)) : 0;
      const bmiDifference = targetBmi - currentBmi;
      
      const getBmiCategory = (bmi) => {
        if (bmi < 18.5) return { text: 'ì €ì²´ì¤‘', class: 'bmi-excellent', icon: 'ğŸ“‰', color: '#4facfe' };
        if (bmi < 25) return { text: 'ì •ìƒ', class: 'bmi-good', icon: 'âœ…', color: '#43e97b' };
        if (bmi < 30) return { text: 'ê³¼ì²´ì¤‘', class: 'bmi-warning', icon: 'âš ï¸', color: '#feca57' };
        return { text: 'ë¹„ë§Œ', class: 'bmi-danger', icon: 'ğŸ”´', color: '#ff6b6b' };
      };

      const bmiCategory = getBmiCategory(currentBmi);
      const targetCategory = getBmiCategory(targetBmi);

      return (
        <div className="glassmorphism rounded-3xl p-6 card-hover fade-in">
          {/* í—¤ë” */}
          <div className="flex items-center justify-between mb-6">
            <div className="flex items-center space-x-4">
              <div className="text-6xl hover:scale-110 transition-transform cursor-pointer">
                {baseData.emoji}
              </div>
              <div>
                <h2 className="text-2xl font-bold text-white mb-1">{baseData.name}</h2>
                <p className="text-white/70 text-sm mb-2">{baseData.desc}</p>
                <div className="flex flex-wrap gap-2 text-xs">
                  <span className="bg-white/10 px-2 py-1 rounded-full text-white/80">
                    <i className="fas fa-birthday-cake mr-1"></i>{baseData.age}ì„¸
                  </span>
                  <span className="bg-white/10 px-2 py-1 rounded-full text-white/80">
                    <i className="fas fa-ruler-vertical mr-1"></i>{baseData.height}cm
                  </span>
                  <span className="bg-white/10 px-2 py-1 rounded-full text-white/80">
                    <i className="fas fa-briefcase mr-1"></i>{baseData.profession}
                  </span>
                </div>
              </div>
            </div>
            <button 
              onClick={() => setShowDetails(!showDetails)}
              className="text-white/60 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-full"
            >
              <i className={`fas ${showDetails ? 'fa-chevron-up' : 'fa-chevron-down'} text-xl`}></i>
            </button>
          </div>

          {/* BMI í˜„í™© */}
          <div className="grid grid-cols-2 gap-6 mb-6">
            <div className="text-center">
              <CircularProgress 
                value={currentBmi} 
                maxValue={35} 
                color={bmiCategory.color}
              />
              <p className="text-white/80 text-sm mt-3 font-medium">í˜„ì¬ BMI</p>
            </div>
            <div className="space-y-3">
              <div className={`${bmiCategory.class} rounded-xl p-4 text-center sparkle`}>
                <div className="text-white font-bold text-lg mb-1">
                  {bmiCategory.icon} {bmiCategory.text}
                </div>
                <div className="text-white/90 text-sm">BMI {currentBmi.toFixed(1)}</div>
              </div>
              {targetBmi > 0 && (
                <div className="bg-white/10 rounded-xl p-3 text-center">
                  <div className="text-white/80 text-sm">ëª©í‘œ: {targetBmi.toFixed(1)}</div>
                  <div className="text-white/60 text-xs">
                    {bmiDifference > 0 ? 'â†‘' : 'â†“'} {Math.abs(bmiDifference).toFixed(1)}
                  </div>
                </div>
              )}
            </div>
          </div>

          {/* ìƒì„¸ ì •ë³´ */}
          {showDetails && (
            <div className="space-y-6 slide-up">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label className="flex items-center text-white/80 font-medium mb-2 text-sm">
                    <i className="fas fa-weight mr-2"></i>í˜„ì¬ ì²´ì¤‘ (kg)
                  </label>
                  <input 
                    type="number" 
                    value={localData.weight || ''} 
                    onChange={e => handleChange('weight', e.target.value)} 
                    step="0.1" 
                    className="w-full p-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 backdrop-blur-sm focus:outline-none focus:border-white/50 focus:bg-white/15 transition-all"
                    placeholder="ì²´ì¤‘ ì…ë ¥"
                  />
                </div>
                
                <div>
                  <label className="flex items-center text-white/80 font-medium mb-2 text-sm">
                    <i className="fas fa-bullseye mr-2"></i>ëª©í‘œ ì²´ì¤‘ (kg)
                  </label>
                  <input 
                    type="number" 
                    value={localData.targetWeight || ''} 
                    onChange={e => handleChange('targetWeight', e.target.value)} 
                    step="0.1" 
                    className="w-full p-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 backdrop-blur-sm focus:outline-none focus:border-white/50 focus:bg-white/15 transition-all"
                    placeholder="ëª©í‘œ ì²´ì¤‘"
                  />
                </div>
                
                <div>
                  <label className="flex items-center text-white/80 font-medium mb-2 text-sm">
                    <i className="fas fa-calendar-alt mr-2"></i>ì¸¡ì • ë‚ ì§œ
                  </label>
                  <input 
                    type="date" 
                    value={localData.date || ''} 
                    onChange={e => handleChange('date', e.target.value)} 
                    className="w-full p-3 bg-white/10 border border-white/20 rounded-xl text-white backdrop-blur-sm focus:outline-none focus:border-white/50 focus:bg-white/15 transition-all"
                  />
                </div>
                
                <div>
                  <label className="flex items-center text-white/80 font-medium mb-2 text-sm">
                    <i className="fas fa-user-circle mr-2"></i>ì²´í˜• íƒ€ì…
                  </label>
                  <select 
                    value={localData.bodyType || 'normal'} 
                    onChange={e => handleChange('bodyType', e.target.value)} 
                    className="w-full p-3 bg-white/10 border border-white/20 rounded-xl text-white backdrop-blur-sm focus:outline-none focus:border-white/50 focus:bg-white/15 transition-all"
                  >
                    <option value="normal">ë³´í†µ ì²´í˜•</option>
                    <option value="muscle">ê·¼ìœ¡/í†µë¼ˆí˜•</option>
                    <option value="slim">ë§ˆë¥¸ ì²´í˜•</option>
                    <option value="obese">ë¹„ë§Œ ì²´í˜•</option>
                  </select>
                </div>
              </div>

              {/* AI ì¸ì‚¬ì´íŠ¸ */}
              <HealthInsights memberData={localData} baseData={baseData} />

              {/* ì €ì¥ ë²„íŠ¼ */}
              <button 
                onClick={handleSave} 
                disabled={isSaving}
                className="w-full py-4 bg-gradient-to-r from-green-400 to-blue-500 text-white font-bold rounded-2xl sparkle hover:from-green-500 hover:to-blue-600 disabled:opacity-50 transition-all transform hover:scale-105 neon-glow"
              >
                {isSaving ? (
                  <div className="flex items-center justify-center space-x-2">
                    <div className="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div>
                    <span>ì €ì¥ ì¤‘...</span>
                  </div>
                ) : (
                  <span>
                    <i className="fas fa-save mr-2"></i>
                    {saveStatus || 'ë°ì´í„° ì €ì¥í•˜ê¸°'}
                  </span>
                )}
              </button>
            </div>
          )}
        </div>
      );
    };

    // ê³ ê¸‰ BMI ì°¨íŠ¸ ì»´í¬ë„ŒíŠ¸
    const AdvancedBMIChart = ({ familyHealthData }) => {
      const chartRef = useRef(null);
      const chartInstance = useRef(null);

      useEffect(() => {
        if (!familyHealthData || !chartRef.current) return;

        Chart.register(ChartDataLabels);
        
        const labels = Object.values(initialFamilyData).map(d => `${d.emoji} ${d.name}`);
        
        const createDataset = (dataKey, fallbackKey) => Object.keys(initialFamilyData).map(id => {
          const memberData = familyHealthData[id] || {};
          const weight = parseFloat(memberData[dataKey]) || parseFloat(memberData[fallbackKey]) || initialFamilyData[id].weight;
          const height = initialFamilyData[id].height / 100;
          return weight > 0 ? parseFloat((weight / (height * height)).toFixed(2)) : null;
        });

        const currentBmis = createDataset('weight', 'weight');
        const targetBmis = createDataset('targetWeight', 'weight');
        const recommendedBmis = Object.values(initialFamilyData).map(d => d.recommendedBMI);

        if (chartInstance.current) {
          chartInstance.current.destroy();
        }

        const ctx = chartRef.current.getContext('2d');
        
        // ë°°ê²½ ê·¸ë¼ë””ì–¸íŠ¸ ìƒì„±
        const bgGradient = ctx.createLinearGradient(0, 0, 0, 400);
        bgGradient.addColorStop(0, 'rgba(79, 172, 254, 0.2)');
        bgGradient.addColorStop(1, 'rgba(79, 172, 254, 0.05)');

        chartInstance.current = new Chart(chartRef.current, {
          type: 'line',
          data: {
            labels,
            datasets: [
              {
                label: 'ğŸ’ª í˜„ì¬ BMI',
                data: currentBmis,
                borderColor: '#4facfe',
                backgroundColor: bgGradient,
                borderWidth: 4,
                tension: 0.4,
                pointRadius: 8,
                pointHoverRadius: 12,
                pointBackgroundColor: '#4facfe',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 3,
                fill: true,
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: '#4facfe'
              },
              {
                label: 'ğŸ¯ ëª©í‘œ BMI',
                data: targetBmis,
                borderColor: '#43e97b',
                backgroundColor: 'transparent',
                borderWidth: 2,
                borderDash: [5, 5],
                tension: 0.4,
                pointRadius: 6,
                pointHoverRadius: 10,
                pointBackgroundColor: '#43e97b',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2
              },
              {
                label: 'ğŸ† ì¶”ì²œ BMI',
                data: recommendedBmis,
                borderColor: '#ff6b6b',
                backgroundColor: 'transparent',
                borderWidth: 2,
                borderDash: [2, 2],
                tension: 0.4,
                pointRadius: 0,
                pointHoverRadius: 0,
                pointBackgroundColor: '#ff6b6b',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: 'rgba(255, 255, 255, 0.9)',
                  font: {
                    weight: 'bold'
                  }
                }
              },
              datalabels: {
                align: 'end',
                anchor: 'end',
                offset: 8,
                font: {
                  weight: 'bold',
                  size: 12
                },
                formatter: (value) => value ? value.toFixed(1) : '',
                color: '#fff',
                textShadowBlur: 5,
                textShadowColor: 'rgba(0,0,0,0.5)'
              },
              tooltip: {
                backgroundColor: 'rgba(0,0,0,0.7)',
                titleColor: '#fff',
                bodyColor: '#fff',
                padding: 10,
                cornerRadius: 10,
                callbacks: {
                  label: (context) => {
                    let label = context.dataset.label || '';
                    if (label) {
                      label += ': ';
                    }
                    if (context.parsed.y !== null) {
                      label += context.parsed.y.toFixed(1);
                    }
                    return label;
                  }
                }
              }
            },
            scales: {
              y: {
                min: 15,
                max: 35,
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)',
                  drawBorder: false
                },
                ticks: {
                  color: 'rgba(255, 255, 255, 0.7)',
                  stepSize: 5,
                  font: {
                    weight: 'bold'
                  }
                },
                title: {
                  display: true,
                  text: 'BMI ì§€ìˆ˜',
                  color: 'rgba(255, 255, 255, 0.9)',
                  font: {
                    weight: 'bold'
                  }
                }
              },
              x: {
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)',
                  drawBorder: false
                },
                ticks: {
                  color: 'rgba(255, 255, 255, 0.9)',
                  font: {
                    weight: 'bold'
                  }
                }
              }
            }
          }
        });

      }, [familyHealthData]);

      return (
        <div className="glassmorphism rounded-3xl p-6 fade-in h-[400px]">
          <h3 className="text-xl font-bold text-white mb-4">
            <i className="fas fa-chart-line mr-2"></i>
            ê°€ì¡± BMI ì¶”ì´
          </h3>
          <div className="h-full w-full">
            <canvas ref={chartRef}></canvas>
          </div>
        </div>
      );
    };

    // ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸
    const App = () => {
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [familyHealthData, setFamilyHealthData] = useState(() => {
        try {
          const savedData = localStorage.getItem('familyHealthData');
          if (savedData) {
            return JSON.parse(savedData);
          }
        } catch (e) {
          console.error("Failed to load data from localStorage", e);
        }
        return initialFamilyData;
      });

      useEffect(() => {
        if (isLoggedIn) {
          try {
            localStorage.setItem('familyHealthData', JSON.stringify(familyHealthData));
          } catch (e) {
            console.error("Failed to save data to localStorage", e);
          }
        }
      }, [familyHealthData, isLoggedIn]);

      const handleUpdate = (updatedMember) => {
        setFamilyHealthData(prev => ({
          ...prev,
          [updatedMember.id]: {
            ...prev[updatedMember.id],
            ...updatedMember
          }
        }));
      };

      if (!isLoggedIn) {
        return <PasswordGate onAccess={setIsLoggedIn} />;
      }

      return (
        <div className="p-4 md:p-8 lg:p-12 text-white">
          <header className="text-center py-8">
            <h1 className="text-5xl md:text-6xl font-extrabold mb-2 gradient-text">
              Ultimate Health Dashboard
            </h1>
            <p className="text-lg md:text-xl font-medium text-white/80">
              <i className="fas fa-heartbeat mr-2 pulse"></i> ìš°ë¦¬ ê°€ì¡± ê±´ê°• ê´€ë¦¬
            </p>
          </header>

          <div className="grid gap-8 mb-12 lg:grid-cols-2 xl:grid-cols-4">
            {Object.keys(familyHealthData).map(id => (
              <FamilyMember
                key={id}
                memberData={familyHealthData[id]}
                onUpdate={handleUpdate}
                baseData={initialFamilyData[id]}
              />
            ))}
          </div>

          <div className="w-full h-[400px]">
            <AdvancedBMIChart familyHealthData={familyHealthData} />
          </div>

          <footer className="text-center text-white/50 text-sm mt-12 py-4 border-t border-white/20">
            Â© 2025. ìˆ˜ì•„ë™í˜ê°€ì¡±. All Rights Reserved.
          </footer>
        </div>
      );
    };

    // ReactDOM.createRootë¡œ ë³€ê²½í•˜ì—¬ ìµœì‹  React ë¬¸ë²• ì‚¬ìš©
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

  </script>
</body>
</html>
