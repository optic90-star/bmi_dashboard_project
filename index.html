<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>가족 건강 대시보드</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, getDoc, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase project config. DO NOT EDIT.
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let db, auth;
        let userId = null;
        let familyHealthData = [];
        let myChart = {}; // Use an object to store multiple chart instances
        
        window.onload = async () => {
            if (Object.keys(firebaseConfig).length > 0) {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        const docRef = doc(db, `artifacts/${appId}/users/${userId}/health_data/family_info`);
                        
                        onSnapshot(docRef, async (docSnap) => {
                            if (!docSnap.exists()) {
                                familyHealthData = [];
                            } else {
                                familyHealthData = Object.values(docSnap.data());
                            }
                            renderIndividualDashboards(familyHealthData);
                            renderFamilyList(familyHealthData);
                            renderChart(familyHealthData);
                            renderAchievementRate(calculateAchievementRate(familyHealthData));
                            populateInputFields(familyHealthData); // Populate fields after loading data
                        }, (error) => {
                            console.error("Data reception error: ", error);
                        });
                    } else {
                        console.log("No user is signed in.");
                        userId = null;
                    }
                });

                try {
                    if (typeof __initial_auth_token !== 'undefined') {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Firebase Auth Error: ", error);
                    const errorMessage = "Firebase authentication failed. Please check your settings.";
                    const errorBox = document.createElement('div');
                    errorBox.textContent = errorMessage;
                    errorBox.style.cssText = "position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:red; color:white; padding:20px; border-radius:10px; z-index:1000;";
                    document.body.appendChild(errorBox);
                    setTimeout(() => errorBox.remove(), 5000);
                }
            } else {
                console.error("Firebase config is empty. Cannot load data.");
                const errorMessage = "Firebase config is empty. Please check the code.";
                const errorBox = document.createElement('div');
                errorBox.textContent = errorMessage;
                errorBox.style.cssText = "position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:red; color:white; padding:20px; border-radius:10px; z-index:1000;";
                document.body.appendChild(errorBox);
                setTimeout(() => errorBox.remove(), 5000);
            }
        };

        const getBmiStatusText = (bmi) => {
            if (bmi < 18.5) return '저체중';
            if (bmi >= 18.5 && bmi < 24.9) return '정상';
            if (bmi >= 25 && bmi < 29.9) return '과체중';
            return '비만';
        };

        const calculateBMI = (height, weight) => {
            if (!height || !weight || height <= 0 || weight <= 0) return 0;
            const heightM = height / 100;
            return (weight / (heightM * heightM));
        };

        const calculateIndividualAchievementRate = (member) => {
            let achievedGoals = 0;
            const latestBmi = member.bmi_history.length > 0 ? member.bmi_history[member.bmi_history.length - 1].bmi : 0;
            const latestWeight = member.weight_history.length > 0 ? member.weight_history[member.weight_history.length - 1].weight : 0;
            
            if (latestBmi >= 18.5 && latestBmi < 24.9) {
                achievedGoals++;
            }
            const isWeightGoalAchieved = member.target_weight && latestWeight >= member.target_weight - 1 && latestWeight <= member.target_weight + 1;
            if (isWeightGoalAchieved) {
                achievedGoals++;
            }
            return Math.round((achievedGoals / 2) * 100);
        }

        const calculateAchievementRate = (data) => {
            if (data.length === 0) return 0;
            let normalCount = 0;
            let weightGoalCount = 0;

            data.forEach(member => {
                const latestBmi = member.bmi_history.length > 0 ? member.bmi_history[member.bmi_history.length - 1].bmi : 0;
                const latestWeight = member.weight_history.length > 0 ? member.weight_history[member.weight_history.length - 1].weight : 0;
                
                if (latestBmi >= 18.5 && latestBmi < 24.9) {
                    normalCount++;
                }

                const isWeightGoalAchieved = member.target_weight && latestWeight >= member.target_weight - 1 && latestWeight <= member.target_weight + 1;
                if (isWeightGoalAchieved) {
                    weightGoalCount++;
                }
            });

            const totalGoals = data.length * 2;
            if (totalGoals === 0) return 0;
            const achievedGoals = normalCount + weightGoalCount;
            return Math.round((achievedGoals / totalGoals) * 100);
        };

        const populateInputFields = (data) => {
            if (!data || data.length === 0) return;

            data.forEach(member => {
                const ageInput = document.getElementById(`age-${member.name}`);
                const genderSelect = document.getElementById(`gender-${member.name}`);
                const bodyTypeSelect = document.getElementById(`body-type-${member.name}`);
                const heightInput = document.getElementById(`height-${member.name}`);
                const weightInput = document.getElementById(`weight-${member.name}`);
                const targetWeightInput = document.getElementById(`target-weight-${member.name}`);

                if (ageInput) ageInput.value = member.age || '';
                if (genderSelect) genderSelect.value = member.gender || '';
                if (bodyTypeSelect) bodyTypeSelect.value = member.body_type || '';
                if (heightInput) heightInput.value = member.height || '';
                if (targetWeightInput) targetWeightInput.value = member.target_weight || '';
                
                const latestWeight = member.weight_history.length > 0 ? member.weight_history[member.weight_history.length - 1].weight : '';
                if (weightInput) weightInput.value = latestWeight;
            });
        };

        window.handleSave = async (memberName) => {
            if (!userId) {
                console.error("Not logged in. Cannot save data.");
                return;
            }

            const age = parseInt(document.getElementById(`age-${memberName}`).value);
            const gender = document.getElementById(`gender-${memberName}`).value;
            const bodyType = document.getElementById(`body-type-${memberName}`).value;
            const height = parseFloat(document.getElementById(`height-${memberName}`).value);
            const weight = parseFloat(document.getElementById(`weight-${memberName}`).value);
            const targetWeight = parseFloat(document.getElementById(`target-weight-${memberName}`).value);

            if (isNaN(age) || !gender || !bodyType || isNaN(height) || isNaN(weight) || isNaN(targetWeight)) {
                console.error('Please enter all information correctly.');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const docRef = doc(db, `artifacts/${appId}/users/${userId}/health_data/family_info`);

            try {
                const docSnap = await getDoc(docRef);
                const currentData = docSnap.exists() ? docSnap.data() : {};

                const existingMemberData = currentData[memberName] || {};
                const bmi = calculateBMI(height, weight);

                const newBmiHistory = [...(existingMemberData.bmi_history || []), { date: today, bmi: bmi }];
                const newWeightHistory = [...(existingMemberData.weight_history || []), { date: today, weight: weight }];
                
                const updatedMemberData = {
                    name: memberName,
                    age,
                    gender,
                    body_type: bodyType,
                    height,
                    target_weight: targetWeight,
                    initial_weight: existingMemberData.initial_weight || weight,
                    bmi_history: newBmiHistory.slice(-5),
                    weight_history: newWeightHistory.slice(-5)
                };

                await setDoc(docRef, {
                    ...currentData,
                    [memberName]: updatedMemberData
                });

            } catch (e) {
                console.error("Document update error: ", e);
            }
        };

        const renderFamilyList = (data) => {
            const listContainer = document.getElementById('family-list-container');
            listContainer.innerHTML = '';
            if (data.length === 0) {
                listContainer.innerHTML = '<p class="text-gray-400">가족 정보를 추가해주세요.</p>';
            } else {
                data.forEach(member => {
                    const latestBmi = member.bmi_history.length > 0 ? member.bmi_history[member.bmi_history.length - 1].bmi : 0;
                    const latestWeight = member.weight_history.length > 0 ? member.weight_history[member.weight_history.length - 1].weight : 0;
                    const bmiStatusText = getBmiStatusText(latestBmi);
                    
                    const memberCard = `
                        <div class="w-full md:w-[calc(50%-8px)] lg:w-[calc(25%-12px)] bg-[#1e2a38] p-4 rounded-xl shadow-md transition-transform hover:scale-105">
                            <h3 class="text-xl font-semibold mb-2">${member.name} (${member.age}, ${member.gender})</h3>
                            <div class="text-sm text-gray-400 space-y-1">
                                <p>체형: ${member.body_type}</p>
                                <p>초기 체중: <span class="text-white font-bold">${member.initial_weight}kg</span></p>
                                <p>현재 체중: <span class="text-white font-bold">${latestWeight}kg</span></p>
                                <p>목표 체중: <span class="text-white font-bold">${member.target_weight}kg</span></p>
                                <p>키: <span class="text-white font-bold">${member.height}cm</span></p>
                                <p>현재 BMI: <span class="text-white font-bold">${latestBmi.toFixed(1)}</span> (${bmiStatusText})</p>
                            </div>
                        </div>
                    `;
                    listContainer.innerHTML += memberCard;
                });
            }
        };

        const renderIndividualDashboards = (data) => {
            const container = document.getElementById('individual-dashboards-container');
            container.innerHTML = '';
            if (data.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center">개별 가족 구성원 대시보드를 보려면 정보를 입력해주세요.</p>';
            } else {
                data.forEach(member => {
                    const sanitizedName = member.name.replace(/\s+/g, '-');
                    const individualRate = calculateIndividualAchievementRate(member);
                    const memberDiv = document.createElement('div');
                    memberDiv.className = 'w-full md:w-[calc(50%-8px)] lg:w-[calc(33.33%-16px)] bmi-container p-6';
                    memberDiv.innerHTML = `
                        <h2 class="text-2xl font-bold mb-4 text-center">${member.name}의 건강 대시보드</h2>
                        
                        <!-- Individual Achievement Rate -->
                        <div class="flex flex-col items-center mb-6">
                            <h3 class="text-xl font-semibold mb-2 text-center">개별 목표 달성률</h3>
                            <p class="text-4xl font-bold mb-2"><span id="individual-rate-${sanitizedName}">${individualRate}%</span></p>
                            <div class="progress-bar-container w-2/3">
                                <div id="individual-progress-bar-${sanitizedName}" class="progress-bar" style="width: ${individualRate}%"></div>
                            </div>
                        </div>
                        
                        <!-- Individual Chart -->
                        <h3 class="text-xl font-semibold mb-2 text-center">체중/BMI 변화 추이</h3>
                        <div class="w-full h-80">
                            <canvas id="individual-chart-${sanitizedName}"></canvas>
                        </div>
                    `;
                    container.appendChild(memberDiv);
                    renderIndividualChart(member, `individual-chart-${sanitizedName}`);
                });
            }
        };

        const renderIndividualChart = (member, canvasId) => {
            const chartCanvas = document.getElementById(canvasId);
            if (!chartCanvas) return;
            if (myChart[canvasId]) {
                myChart[canvasId].destroy();
            }

            const allDates = [...new Set(member.weight_history.map(d => d.date))].sort();
            const color = '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');

            myChart[canvasId] = new Chart(chartCanvas, {
                data: {
                    labels: allDates,
                    datasets: [
                        {
                            label: `체중 (${member.name})`,
                            data: allDates.map(date => {
                                const record = member.weight_history.find(d => d.date === date);
                                return record ? record.weight : null;
                            }),
                            borderColor: color,
                            backgroundColor: color,
                            type: 'line',
                            fill: false,
                            yAxisID: 'y-weight',
                            borderDash: []
                        },
                        {
                            label: `BMI (${member.name})`,
                            data: allDates.map(date => {
                                const record = member.bmi_history.find(d => d.date === date);
                                return record ? record.bmi : null;
                            }),
                            borderColor: color,
                            backgroundColor: color,
                            type: 'line',
                            fill: false,
                            yAxisID: 'y-bmi',
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    spanGaps: true,
                    plugins: {
                        legend: { labels: { color: 'white' } },
                        datalabels: { color: 'white', anchor: 'end', align: 'top', formatter: (value) => value ? value.toFixed(1) : '' }
                    },
                    scales: {
                        x: { ticks: { color: 'white' }, grid: { color: 'rgba(255, 255, 255, 0.2)' } },
                        'y-weight': {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: '체중 (kg)', color: 'white' },
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.2)' }
                        },
                        'y-bmi': {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'BMI', color: 'white' },
                            ticks: { color: 'white' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        };

        const renderAchievementRate = (rate) => {
            const rateDisplay = document.getElementById('achievement-rate-display');
            const progressBar = document.getElementById('progress-bar');
            rateDisplay.textContent = `${rate}%`;
            progressBar.style.width = `${rate}%`;
        };

        window.renderChart = (data) => {
            const chartCanvas = document.getElementById('bmi-chart');
            if (myChart['combined']) {
                myChart['combined'].destroy();
            }

            const allDates = [...new Set(data.flatMap(member => member.weight_history.map(d => d.date)))].sort();
            
            const datasets = [];
            data.forEach(member => {
                const color = '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');
                
                // Weight Dataset (Solid Line)
                datasets.push({
                    label: `${member.name} 체중`,
                    data: allDates.map(date => {
                        const record = member.weight_history.find(d => d.date === date);
                        return record ? record.weight : null;
                    }),
                    borderColor: color,
                    backgroundColor: color,
                    type: 'line',
                    fill: false,
                    yAxisID: 'y-weight',
                    borderDash: []
                });

                // BMI Dataset (Dashed Line)
                datasets.push({
                    label: `${member.name} BMI`,
                    data: allDates.map(date => {
                        const record = member.bmi_history.find(d => d.date === date);
                        return record ? record.bmi : null;
                    }),
                    borderColor: color,
                    backgroundColor: color,
                    type: 'line',
                    fill: false,
                    yAxisID: 'y-bmi',
                    borderDash: [5, 5] // Dashed line
                });
            });

            myChart['combined'] = new Chart(chartCanvas, {
                data: {
                    labels: allDates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    spanGaps: true,
                    plugins: {
                        legend: { labels: { color: 'white' } },
                        title: { display: true, text: '가족 건강 변화 추이', color: 'white', font: { size: 18 } },
                        datalabels: { color: 'white', anchor: 'end', align: 'top', formatter: (value) => value ? value.toFixed(1) : '' }
                    },
                    scales: {
                        x: { ticks: { color: 'white' }, grid: { color: 'rgba(255, 255, 255, 0.2)' } },
                        'y-weight': {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: '체중 (kg)', color: 'white' },
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.2)' }
                        },
                        'y-bmi': {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'BMI', color: 'white' },
                            ticks: { color: 'white' },
                            grid: { drawOnChartArea: false } // No grid lines for the right axis
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        };
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0D1117;
            color: #ffffff;
        }
        .bmi-container {
            background-color: #161B22;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .progress-bar-container {
            width: 100%;
            height: 12px;
            background-color: #2e3a4e;
            border-radius: 6px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.5s ease-in-out;
        }
        input, select {
            background-color: #21262D;
            border: 1px solid #30363D;
        }
        button {
            background-color: #2161D5;
        }
        button:hover {
            background-color: #174291;
        }
    </style>
</head>
<body class="p-6 md:p-12 min-h-screen flex flex-col items-center justify-center space-y-8">
    <div class="w-full max-w-4xl mx-auto space-y-8">
        <!-- Input Form (Unified and Horizontal) -->
        <div class="bmi-container p-6">
            <h2 class="text-2xl font-bold mb-4 text-center">가족 건강 정보 입력</h2>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end mb-4">
                <div class="font-bold text-sm text-gray-400">항목</div>
                <div class="text-center font-bold text-sm">아빠</div>
                <div class="text-center font-bold text-sm">엄마</div>
                <div class="text-center font-bold text-sm">큰딸</div>
                <div class="text-center font-bold text-sm">둘째아들</div>
            </div>

            <!-- Age Row -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center mb-2">
                <label class="font-medium text-sm text-gray-400">나이</label>
                <input type="number" id="age-아빠" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 45">
                <input type="number" id="age-엄마" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 42">
                <input type="number" id="age-큰딸" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 16">
                <input type="number" id="age-둘째아들" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 12">
            </div>

            <!-- Gender Row -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center mb-2">
                <label class="font-medium text-sm text-gray-400">성별</label>
                <select id="gender-아빠" class="col-span-1 block w-full rounded-md shadow-sm">
                    <option value="남자">남자</option>
                    <option value="여자">여자</option>
                </select>
                <select id="gender-엄마" class="col-span-1 block w-full rounded-md shadow-sm">
                    <option value="남자">남자</option>
                    <option value="여자">여자</option>
                </select>
                <select id="gender-큰딸" class="col-span-1 block w-full rounded-md shadow-sm">
                    <option value="남자">남자</option>
                    <option value="여자">여자</option>
                </select>
                <select id="gender-둘째아들" class="col-span-1 block w-full rounded-md shadow-sm">
                    <option value="남자">남자</option>
                    <option value="여자">여자</option>
                </select>
            </div>
            
            <!-- Body Type Row -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center mb-2">
                <label class="font-medium text-sm text-gray-400">체형</label>
                <select id="body-type-아빠" class="col-span-1 block w-full rounded-md shadow-sm">
                    <option value="표준">표준</option>
                    <option value="마른 체형">마른 체형</option>
                    <option value="근육형">근육형</option>
                </select>
                <select id="body-type-엄마" class="col-span-1 block w-full rounded-md shadow-sm">
                    <option value="표준">표준</option>
                    <option value="마른 체형">마른 체형</option>
                    <option value="근육형">근육형</option>
                </select>
                <select id="body-type-큰딸" class="col-span-1 block w-full rounded-md shadow-sm">
                    <option value="표준">표준</option>
                    <option value="마른 체형">마른 체형</option>
                    <option value="근육형">근육형</option>
                </select>
                <select id="body-type-둘째아들" class="col-span-1 block w-full rounded-md shadow-sm">
                    <option value="표준">표준</option>
                    <option value="마른 체형">마른 체형</option>
                    <option value="근육형">근육형</option>
                </select>
            </div>

            <!-- Height Row -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center mb-2">
                <label class="font-medium text-sm text-gray-400">키 (cm)</label>
                <input type="number" id="height-아빠" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 175">
                <input type="number" id="height-엄마" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 162">
                <input type="number" id="height-큰딸" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 165">
                <input type="number" id="height-둘째아들" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 150">
            </div>

            <!-- Current Weight Row -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center mb-2">
                <label class="font-medium text-sm text-gray-400">현재 체중 (kg)</label>
                <input type="number" id="weight-아빠" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 70">
                <input type="number" id="weight-엄마" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 58">
                <input type="number" id="weight-큰딸" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 50">
                <input type="number" id="weight-둘째아들" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 43">
            </div>

            <!-- Target Weight Row -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center mb-2">
                <label class="font-medium text-sm text-gray-400">목표 체중 (kg)</label>
                <input type="number" id="target-weight-아빠" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 68">
                <input type="number" id="target-weight-엄마" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 55">
                <input type="number" id="target-weight-큰딸" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 52">
                <input type="number" id="target-weight-둘째아들" class="col-span-1 block w-full rounded-md shadow-sm placeholder-gray-400" placeholder="예: 45">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mt-6">
                <div></div>
                <button onclick="handleSave('아빠')" class="w-full py-2 px-4 rounded-md shadow-sm text-sm font-medium text-white transition-colors">
                    저장
                </button>
                <button onclick="handleSave('엄마')" class="w-full py-2 px-4 rounded-md shadow-sm text-sm font-medium text-white transition-colors">
                    저장
                </button>
                <button onclick="handleSave('큰딸')" class="w-full py-2 px-4 rounded-md shadow-sm text-sm font-medium text-white transition-colors">
                    저장
                </button>
                <button onclick="handleSave('둘째아들')" class="w-full py-2 px-4 rounded-md shadow-sm text-sm font-medium text-white transition-colors">
                    저장
                </button>
            </div>
        </div>
        
        <hr class="border-t border-gray-600 my-8">

        <!-- Individual Family Dashboards -->
        <h2 class="text-2xl font-bold mb-4 text-center">개별 건강 대시보드</h2>
        <div id="individual-dashboards-container" class="space-y-8 flex flex-wrap gap-4">
            <!-- Dynamic dashboards will be inserted here -->
            <p class="text-gray-400 text-center w-full">개별 가족 구성원 대시보드를 보려면 정보를 입력해주세요.</p>
        </div>

        <hr class="border-t border-gray-600 my-8">

        <!-- Overall Health Summary & Trends (Combined Dashboard) -->
        <div class="bmi-container p-6 flex flex-col items-center justify-center">
            <h2 class="text-2xl font-bold mb-4 text-center">가족 건강 요약 및 추이</h2>
            
            <div class="w-full md:w-1/2 flex flex-col items-center mb-6">
                <h3 class="text-xl font-semibold mb-2 text-center">종합 건강 달성률</h3>
                <p class="text-4xl font-bold mb-2"><span id="achievement-rate-display">0%</span></p>
                <div class="progress-bar-container w-2/3">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
            </div>

            <div class="w-full h-80">
                <canvas id="bmi-chart"></canvas>
            </div>
        </div>
        
        <!-- Registered Family List -->
        <div class="bmi-container p-6">
            <h2 class="text-2xl font-bold mb-4">등록된 가족</h2>
            <div id="family-list-container" class="flex flex-wrap gap-4 w-full justify-center md:justify-start">
                <p class="text-gray-400">가족 정보를 추가해주세요.</p>
            </div>
        </div>

        <!-- BMI Reference Table -->
        <div class="bmi-container p-6">
            <h2 class="text-2xl font-bold mb-4 text-center">BMI 지수 참고표</h2>
            <div class="text-sm text-gray-300 mb-4 text-center">
                <p>BMI 지수는 키와 체중만으로 측정되는 지표입니다. 아래 표는 일반적인 참고 기준이며, 나이, 성별, 체형에 따라 건강한 BMI 범위는 달라질 수 있습니다.</p>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div class="bg-[#1e2a38] p-3 rounded-lg">
                    <p class="text-lg font-semibold">저체중</p>
                    <p class="text-sm text-yellow-400">18.5 미만</p>
                </div>
                <div class="bg-[#1e2a38] p-3 rounded-lg">
                    <p class="text-lg font-semibold">정상 체중</p>
                    <p class="text-sm text-green-400">18.5 ~ 24.9</p>
                </div>
                <div class="bg-[#1e2a38] p-3 rounded-lg">
                    <p class="text-lg font-semibold">과체중</p>
                    <p class="text-sm text-orange-400">25.0 ~ 29.9</p>
                </div>
                <div class="bg-[#1e2a38] p-3 rounded-lg">
                    <p class="text-lg font-semibold">비만</p>
                    <p class="text-sm text-red-400">30.0 이상</p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
